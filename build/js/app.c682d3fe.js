!function(e){function t(t){for(var o,a,s=t[0],c=t[1],v=t[2],h=0,u=[];h<s.length;h++)a=s[h],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&u.push(i[a][0]),i[a]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);for(l&&l(t);u.length;)u.shift()();return r.push.apply(r,v||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],o=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(o=!1)}o&&(r.splice(t--,1),e=a(a.s=n[0]))}return e}var o={},i={0:0},r=[];function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var v=0;v<s.length;v++)t(s[v]);var l=c;r.push([107,1]),n()}({107:function(e,t,n){"use strict";n.r(t);n(37),n(56),n(57),n(83),n(34),n(90),n(63),n(64),n(93),n(67),n(94),n(95),n(68),n(101),n(102),n(105);function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var i=Object.freeze({WALL:255,WAY:0,START:1,END:2,UP:3,DOWN:4,LEFT:5,RIGHT:6,UP_FOUND:7,DOWN_FOUND:8,LEFT_FOUND:9,RIGHT_FOUND:10}),r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"solve",value:function(e,t,n){cv.copyMakeBorder(e,e,1,1,1,1,cv.BORDER_CONSTANT,[255,255,255,255]);var o=function(t,n,o){e.data[t*e.cols+n]=o},r=function(t,n){return e.ucharAt(t,n)},a=[];a.push(t),a.push(n),o(t.y,t.x,i.START);var s=[];s.push(t);for(var c=!1;0!==s.length;){var v=s.shift();if(v.x===n.x&&v.y===n.y){c=!0;break}try{r(v.y,v.x-1)==i.WAY&&(o(v.y,v.x-1,i.RIGHT),s.push({y:v.y,x:v.x-1})),r(v.y,v.x+1)==i.WAY&&(o(v.y,v.x+1,i.LEFT),s.push({y:v.y,x:v.x+1})),r(v.y-1,v.x)==i.WAY&&(o(v.y-1,v.x,i.DOWN),s.push({y:v.y-1,x:v.x})),r(v.y+1,v.x)==i.WAY&&(o(v.y+1,v.x,i.UP),s.push({y:v.y+1,x:v.x}))}catch(e){console.log(e)}}var l=n;if(c)try{for(;r(l.y,l.x)!=i.START;)r(l.y,l.x)==i.UP&&(a.push(l),o(l.y,l.x,i.UP_FOUND),l={x:l.x,y:l.y-1}),r(l.y,l.x)==i.DOWN&&(a.push(l),o(l.y,l.x,i.DOWN_FOUND),l={x:l.x,y:l.y+1}),r(l.y,l.x)==i.LEFT&&(a.push(l),o(l.y,l.x,i.LEFT_FOUND),l={x:l.x-1,y:l.y}),r(l.y,l.x)==i.RIGHT&&(a.push(l),o(l.y,l.x,i.RIGHT_FOUND),l={x:l.x+1,y:l.y})}catch(e){console.log(e)}return{is_solved:c,path:a}}}],(n=null)&&o(t.prototype,n),r&&o(t,r),e}();function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var s=function(e){if(void 0===e)e="";else if("number"==typeof e)isNaN(e)||"undefined"!=typeof cv&&(e="Exception: "+cv.exceptionFromPtr(e).msg);else if("string"==typeof e){var t=Number(e.split(" ")[0]);isNaN(t)||"undefined"!=typeof cv&&(e="Exception: "+cv.exceptionFromPtr(t).msg)}else e instanceof Error&&(e=e.stack.replace(/\n/g,"<br>"));throw new Error(e)},c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.video=t,this.context_labirynth=document.getElementById("canvas_output_labirynth").getContext("2d"),this.context_green_points=document.getElementById("canvas_output_green_points").getContext("2d"),this.context_solved_path=document.getElementById("canvas_output_solved_path").getContext("2d"),this.frame_from_video=cv.Mat.zeros(this.video.offsetHeight,this.video.offsetWidth,cv.CV_8UC4),this.labirynth_mask=new cv.Mat(t.offsetHeight,t.offsetWidth,cv.CV_8UC1),this.circles=cv.Mat.zeros(this.video.offsetHeight,this.video.offsetWidth,cv.CV_8UC4),this.solved_path_mask=cv.Mat.zeros(this.video.offsetHeight,this.video.offsetWidth,cv.CV_8UC4),this.FPS=1,this.sensivity_of_geeting_labirynth=110,this.lower_green=[30,80,75,0],this.upper_green=[85,255,255,255],this.green=[0,255,0,128],this.path_color=[214,6,214,255]}var t,n,o;return t=e,(n=[{key:"find_position_of_end_points",value:function(e){var t=new cv.MatVector,n=new cv.Mat;cv.findContours(e,t,n,cv.RETR_CCOMP,cv.CHAIN_APPROX_SIMPLE),n.delete();var o=[];if(t.size()>=2)for(var i=0,r=0,a=0;a<t.size();a++){var s=cv.contourArea(t.get(a),!1);if(s>i){r=i,i=s;var c=cv.boundingRect(t.get(a));o[1]=o[0],o[0]={x:Math.round(c.x+c.width/2),y:Math.round(c.y+c.height/2),radius:Math.round(Math.max(c.height,c.width)/2)}}else if(s>r){r=s;var v=cv.boundingRect(t.get(a));o[1]={x:Math.round(v.x+v.width/2),y:Math.round(v.y+v.height/2),radius:Math.round(Math.max(v.height,v.width)/2)}}}return t.delete(),o}},{key:"calculateMaze",value:function(){try{var e=new cv.Mat;cv.cvtColor(this.frame_from_video,e,cv.COLOR_RGBA2GRAY,0),cv.threshold(e,e,this.sensivity_of_geeting_labirynth,255,cv.THRESH_BINARY_INV),cv.dilate(e,this.labirynth_mask,cv.Mat.ones(3,3,cv.CV_8U),new cv.Point(-1,-1),1,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue());var t=new cv.Mat;cv.cvtColor(this.frame_from_video,t,cv.COLOR_BGR2HSV,0);var n=new cv.Mat(t.rows,t.cols,t.type(),this.lower_green),o=new cv.Mat(t.rows,t.cols,t.type(),this.upper_green),i=new cv.Mat;cv.inRange(t,n,o,i),cv.dilate(i,i,cv.Mat.ones(5,5,cv.CV_8U),new cv.Point(-1,-1),1,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue());var a=new cv.Mat;cv.subtract(this.labirynth_mask,i,this.labirynth_mask,a,-1);var c=this.find_position_of_end_points(i);if(this.circles=cv.Mat.zeros(this.video.offsetHeight,this.video.offsetWidth,cv.CV_8UC4),this.solved_path_mask=cv.Mat.zeros(this.video.offsetHeight,this.video.offsetWidth,cv.CV_8UC4),c.length>0){this.is_green_points=!0,cv.circle(this.circles,new cv.Point(c[0].x,c[0].y),2*c[0].radius,this.green,-1),cv.circle(this.circles,new cv.Point(c[1].x,c[1].y),2*c[1].radius,this.green,-1);var v=r.solve(this.labirynth_mask,c[0],c[1]);if(v.is_solved&&this.labirynth_mask.isContinuous()){var l=!0,h=!1,u=void 0;try{for(var d,f=v.path[Symbol.iterator]();!(l=(d=f.next()).done);l=!0){var _=d.value,p=this.solved_path_mask.channels(),y=_.y*this.solved_path_mask.cols*p+_.x*p;this.solved_path_mask.data[y]=this.path_color[0],this.solved_path_mask.data[y+1]=this.path_color[1],this.solved_path_mask.data[y+2]=this.path_color[2],this.solved_path_mask.data[y+3]=this.path_color[3]}}catch(e){h=!0,u=e}finally{try{l||null==f.return||f.return()}finally{if(h)throw u}}cv.dilate(this.solved_path_mask,this.solved_path_mask,cv.Mat.ones(4,4,cv.CV_8U),new cv.Point(-1,-1),1,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue())}}else this.is_green_points=!1;e.delete(),a.delete(),n.delete(),o.delete(),t.delete(),i.delete()}catch(e){console.log(e),s(e)}}},{key:"start",value:function(){var e=this,t=new cv.VideoCapture(this.video);setTimeout((function(){return function n(){try{var o=Date.now();t.read(e.frame_from_video),e.calculateMaze(),e.context_green_points.clearRect(0,0,e.video.offsetHeight,e.video.offsetWidth),cv.imshow("canvas_output_green_points",e.circles),e.context_solved_path.clearRect(0,0,e.video.offsetHeight,e.video.offsetWidth),cv.imshow("canvas_output_solved_path",e.solved_path_mask);var i=1e3/e.FPS-(Date.now()-o);setTimeout((function(){return n()}),i)}catch(e){console.log(e),s(e)}}()}),0)}}])&&a(t.prototype,n),o&&a(t,o),e}();document.getElementById("opencv").onload=function(){cv.onRuntimeInitialized=function(){var e=document.getElementById("video_input");if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){var t=[];navigator.mediaDevices.enumerateDevices().then((function(e){e.forEach((function(e){"videoinput"==e.kind&&t.push(e.deviceId)})),document.getElementById("status").innerHTML="";var n=!0,o=!1,i=void 0;try{for(var r,a=t[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){var s=r.value;document.getElementById("status").innerHTML=s+document.getElementById("status").innerHTML}}catch(e){o=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}})).catch((function(e){console.log(e.name+": "+e.message)}));var n={audio:!1,video:{deviceId:{exact:t[0]}}};navigator.mediaDevices||(document.getElementById("status").innerHTML="navigator.mediaDevices is undefined"),navigator.mediaDevices.getUserMedia(n).then((function(t){e.srcObject=t,e.play(),e.addEventListener("canplaythrough",(function(){for(var t=0,n=["video_input","canvas_output_labirynth","canvas_output_solved_path","canvas_output_green_points"];t<n.length;t++){var o=n[t];document.getElementById(o).width=e.offsetWidth,document.getElementById(o).height=e.offsetHeight}document.getElementById("container").style.width=e.offsetWidth+"px",document.getElementById("container").style.height=e.offsetHeight+"px",document.getElementById("panel").style.width=e.offsetWidth+"px";for(var i=0,r=["container","loading","panel"];i<r.length;i++){var a=r[i];document.getElementById(a).classList+=" loaded"}new c(e).start()}))})).catch((function(e){console.log("navigator.getUserMedia error: ",e)}))}else console.log("enumerateDevices() not supported.")}}},94:function(e,t,n){}});
//# sourceMappingURL=app.c682d3fe.js.map