!function(e){function t(t){for(var o,a,s=t[0],c=t[1],l=t[2],v=0,h=[];v<s.length;v++)a=s[v],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&h.push(i[a][0]),i[a]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);for(u&&u(t);h.length;)h.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],o=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(o=!1)}o&&(r.splice(t--,1),e=a(a.s=n[0]))}return e}var o={},i={0:0},r=[];function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;r.push([119,1]),n()}({119:function(e,t,n){"use strict";n.r(t);n(74),n(55),n(81),n(82),n(83),n(87),n(88),n(89),n(62),n(99),n(103),n(107),n(67),n(110),n(111),n(112),n(113),n(116),n(117);function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var i=Object.freeze({WALL:255,WAY:0,START:1,END:2,UP:3,DOWN:4,LEFT:5,RIGHT:6,UP_FOUND:7,DOWN_FOUND:8,LEFT_FOUND:9,RIGHT_FOUND:10}),r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"solve",value:function(e,t,n){cv.copyMakeBorder(e,e,1,1,1,1,cv.BORDER_CONSTANT,[255,255,255,255]);var o=function(t,n,o){e.data[t*e.cols+n]=o},r=function(t,n){return e.ucharAt(t,n)},a=[];a.push(t),a.push(n),o(t.y,t.x,i.START);var s=[];s.push(t);for(var c=!1;0!==s.length;){var l=s.shift();if(l.x===n.x&&l.y===n.y){c=!0;break}try{r(l.y,l.x-1)==i.WAY&&(o(l.y,l.x-1,i.RIGHT),s.push({y:l.y,x:l.x-1})),r(l.y,l.x+1)==i.WAY&&(o(l.y,l.x+1,i.LEFT),s.push({y:l.y,x:l.x+1})),r(l.y-1,l.x)==i.WAY&&(o(l.y-1,l.x,i.DOWN),s.push({y:l.y-1,x:l.x})),r(l.y+1,l.x)==i.WAY&&(o(l.y+1,l.x,i.UP),s.push({y:l.y+1,x:l.x}))}catch(e){console.log(e)}}var u=n;if(c)try{for(;r(u.y,u.x)!=i.START;)r(u.y,u.x)==i.UP&&(a.push(u),o(u.y,u.x,i.UP_FOUND),u={x:u.x,y:u.y-1}),r(u.y,u.x)==i.DOWN&&(a.push(u),o(u.y,u.x,i.DOWN_FOUND),u={x:u.x,y:u.y+1}),r(u.y,u.x)==i.LEFT&&(a.push(u),o(u.y,u.x,i.LEFT_FOUND),u={x:u.x-1,y:u.y}),r(u.y,u.x)==i.RIGHT&&(a.push(u),o(u.y,u.x,i.RIGHT_FOUND),u={x:u.x+1,y:u.y})}catch(e){console.log(e)}return{is_solved:c,path:a}}}],(n=null)&&o(t.prototype,n),r&&o(t,r),e}();function a(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,c=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw r}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function c(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var l=function(e){if(void 0===e)e="";else if("number"==typeof e)isNaN(e)||"undefined"!=typeof cv&&(e="Exception: "+cv.exceptionFromPtr(e).msg);else if("string"==typeof e){var t=Number(e.split(" ")[0]);isNaN(t)||"undefined"!=typeof cv&&(e="Exception: "+cv.exceptionFromPtr(t).msg)}else e instanceof Error&&(e=e.stack.replace(/\n/g,"<br>"));throw new Error(e)},u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.video=t,this.context_labirynth=document.getElementById("canvas_output_labirynth").getContext("2d"),this.context_green_points=document.getElementById("canvas_output_green_points").getContext("2d"),this.context_solved_path=document.getElementById("canvas_output_solved_path").getContext("2d"),this.frame_from_video=cv.Mat.zeros(this.video.offsetHeight,this.video.offsetWidth,cv.CV_8UC4),this.labirynth_mask=new cv.Mat(t.offsetHeight,t.offsetWidth,cv.CV_8UC1),this.circles=cv.Mat.zeros(this.video.offsetHeight,this.video.offsetWidth,cv.CV_8UC4),this.solved_path_mask=cv.Mat.zeros(this.video.offsetHeight,this.video.offsetWidth,cv.CV_8UC4),this.FPS=1,this.sensivity_of_geeting_labirynth=110,this.lower_green=[30,80,75,0],this.upper_green=[85,255,255,255],this.green=[0,255,0,128],this.path_color=[214,6,214,255]}var t,n,o;return t=e,(n=[{key:"find_position_of_end_points",value:function(e){var t=new cv.MatVector,n=new cv.Mat;cv.findContours(e,t,n,cv.RETR_CCOMP,cv.CHAIN_APPROX_SIMPLE),n.delete();var o=[];if(t.size()>=2)for(var i=0,r=0,a=0;a<t.size();a++){var s=cv.contourArea(t.get(a),!1);if(s>i){r=i,i=s;var c=cv.boundingRect(t.get(a));o[1]=o[0],o[0]={x:Math.round(c.x+c.width/2),y:Math.round(c.y+c.height/2),radius:Math.round(Math.max(c.height,c.width)/2)}}else if(s>r){r=s;var l=cv.boundingRect(t.get(a));o[1]={x:Math.round(l.x+l.width/2),y:Math.round(l.y+l.height/2),radius:Math.round(Math.max(l.height,l.width)/2)}}}return t.delete(),o}},{key:"calculateMaze",value:function(){try{var e=new cv.Mat;cv.cvtColor(this.frame_from_video,e,cv.COLOR_RGBA2GRAY,0),cv.threshold(e,e,this.sensivity_of_geeting_labirynth,255,cv.THRESH_BINARY_INV),cv.dilate(e,this.labirynth_mask,cv.Mat.ones(3,3,cv.CV_8U),new cv.Point(-1,-1),1,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue());var t=new cv.Mat;cv.cvtColor(this.frame_from_video,t,cv.COLOR_BGR2HSV,0);var n=new cv.Mat(t.rows,t.cols,t.type(),this.lower_green),o=new cv.Mat(t.rows,t.cols,t.type(),this.upper_green),i=new cv.Mat;cv.inRange(t,n,o,i),cv.dilate(i,i,cv.Mat.ones(5,5,cv.CV_8U),new cv.Point(-1,-1),1,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue());var s=new cv.Mat;cv.subtract(this.labirynth_mask,i,this.labirynth_mask,s,-1);var c=this.find_position_of_end_points(i);if(this.circles=cv.Mat.zeros(this.video.offsetHeight,this.video.offsetWidth,cv.CV_8UC4),this.solved_path_mask=cv.Mat.zeros(this.video.offsetHeight,this.video.offsetWidth,cv.CV_8UC4),c.length>0){this.is_green_points=!0,cv.circle(this.circles,new cv.Point(c[0].x,c[0].y),2*c[0].radius,this.green,-1),cv.circle(this.circles,new cv.Point(c[1].x,c[1].y),2*c[1].radius,this.green,-1);var u=r.solve(this.labirynth_mask,c[0],c[1]);if(u.is_solved&&this.labirynth_mask.isContinuous()){var v,h=a(u.path);try{for(h.s();!(v=h.n()).done;){var d=v.value,f=this.solved_path_mask.channels(),p=d.y*this.solved_path_mask.cols*f+d.x*f;this.solved_path_mask.data[p]=this.path_color[0],this.solved_path_mask.data[p+1]=this.path_color[1],this.solved_path_mask.data[p+2]=this.path_color[2],this.solved_path_mask.data[p+3]=this.path_color[3]}}catch(e){h.e(e)}finally{h.f()}cv.dilate(this.solved_path_mask,this.solved_path_mask,cv.Mat.ones(4,4,cv.CV_8U),new cv.Point(-1,-1),1,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue())}}else this.is_green_points=!1;e.delete(),s.delete(),n.delete(),o.delete(),t.delete(),i.delete()}catch(e){console.log(e),l(e)}}},{key:"start",value:function(){var e=this,t=new cv.VideoCapture(this.video);setTimeout((function(){return function n(){try{var o=Date.now();t.read(e.frame_from_video),e.calculateMaze(),e.context_green_points.clearRect(0,0,e.video.offsetHeight,e.video.offsetWidth),cv.imshow("canvas_output_green_points",e.circles),e.context_solved_path.clearRect(0,0,e.video.offsetHeight,e.video.offsetWidth),cv.imshow("canvas_output_solved_path",e.solved_path_mask);var i=1e3/e.FPS-(Date.now()-o);setTimeout((function(){return n()}),i)}catch(e){console.log(e),l(e)}}()}),0)}}])&&c(t.prototype,n),o&&c(t,o),e}();document.getElementById("opencv").onload=function(){cv.onRuntimeInitialized=function(){var e=document.getElementById("video_input");if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){var t,n=[],o=0;navigator.mediaDevices.enumerateDevices().then((function(e){e.forEach((function(e){"videoinput"==e.kind&&n.push(e.deviceId)})),document.getElementById("flip_camera_button").addEventListener("click",(function(){n.length>1&&(o=1==o?0:1,t.getTracks().forEach((function(e){e.stop()})),navigator.mediaDevices.getUserMedia(i).then(r).catch(a),document.getElementById("status").innerHTML=n[0]+"<br/>"+n[1]),console.log(t)})),navigator.mediaDevices.getUserMedia(i).then(r).catch(a)})).catch((function(e){console.log(e.name+": "+e.message)}));var i={audio:!1,video:{deviceId:{exact:n[o]}}};navigator.mediaDevices||(document.getElementById("status").innerHTML="navigator.mediaDevices is undefined")}else console.log("enumerateDevices() not supported.");function r(n){t=n,e.srcObject=n,e.play(),e.addEventListener("canplaythrough",(function(){for(var t=0,n=["video_input","canvas_output_labirynth","canvas_output_solved_path","canvas_output_green_points"];t<n.length;t++){var o=n[t];document.getElementById(o).width=e.offsetWidth,document.getElementById(o).height=e.offsetHeight}document.getElementById("container").style.width=e.offsetWidth+"px",document.getElementById("container").style.height=e.offsetHeight+"px",document.getElementById("panel").style.width=e.offsetWidth+"px";for(var i=0,r=["container","loading","panel"];i<r.length;i++){var a=r[i];document.getElementById(a).classList+=" loaded"}new u(e).start()}))}function a(e){console.log("navigator.getUserMedia error: ",e)}}}},82:function(e,t,n){}});
//# sourceMappingURL=app.7f77d19e.js.map